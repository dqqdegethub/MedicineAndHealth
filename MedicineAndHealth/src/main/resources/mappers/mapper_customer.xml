<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://www.mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="MedicineAndHealth.login">
     <resultMap type="MedicineAndHealth.entity.Customer" id="customer">
     	<result column="id" property="id"/>
     	<result column="username" property="userName"/>
      	<result column="password" property="password"/> 
      	<result column="realname" property="realName"/>
      	<result column="phonenumber" property="phoneNumber" />
      	<result column="address" property="address" />
      	<result column="coupon" property="coupon" />
      	<result column="message" property="message"/>
      	<result column="answer" property="answer"/>
     </resultMap>
     
     <resultMap type="MedicineAndHealth.entity.Indent" id="indentQuery">
     	<result column="medicineId" property="medicineId"/>
     	<result column="name" property="medicineName"/>
     	<result column="count" property="count"/>
      	<result column="company" property="company"/> 
      	<result column="packagecode" property="packagecode"/>
      	<result column="state" property="state"/>
     </resultMap>
     
 	<select id="query" parameterType="java.util.Map" resultType="java.lang.Integer">
 	 	select count(*)
 	 	 from customer
 	  	where username=#{userName} and password=#{password}
 	</select>
 	<select id="queryById" parameterType="java.lang.Integer" resultMap="customer">
 		select id,username
 		from customer
 		where id=#{id}
 	</select>
 	<update id="updatePwd" parameterType="java.util.Map">
 		update customer
 		set password=#{password}
 		where id=#{id}
 	</update>
 	<select id="queryByAnswer" parameterType="java.util.Map" resultType="java.lang.Integer">
 		select id
 		from customer
 		where username=#{userName} and answer=#{answer}
 	</select>
 	
	 <select id="login" parameterType="java.util.Map" resultMap="customer">
	     SELECT
	     	id,username
	     FROM
	     	customer
	     WHERE
	     	username = #{userName}
	     AND password = #{password}
	 </select>
	 
	 <insert id="register" parameterType="java.util.Map" useGeneratedKeys="true" keyProperty="id">
	INSERT INTO customer(
	username,
	password,
	realname,
	phonenumber,
	address,
	answer
	
	)
	VALUES
		(
			#{userName}, #{password},#{realName},#{phoneNumber},#{address},#{answer}
	)
	</insert>
<!-- 	 <insert id="register" parameterType="Cusotmer" useGenerated="true" keyProperty="useId">   -->
<!--     insert into user(userId,username,password)  -->
<!--     values(#{id},#{name},#{password})   -->
<!--     </insert> -->
 
	<select id="indentComfirmQuery" parameterType="java.lang.Integer" resultMap="indentQuery">
	SELECT 
		indent.medicineid as medicineId,
		packagecode,
		name,
		indent.count as count,
		company
	FROM 
		indent,medicine,delivery
	WHERE 
		indent.medicineid=medicine.id AND delivery.id=indent.companyid AND indent.customerid=#{customerId} AND indent.state='已发货'
	</select>
	
	<update id="indentComfirm" parameterType="java.util.Map">
		UPDATE
			indent
		SET
			state='已收货'
		WHERE
			customerid=#{customerId} AND medicineid=#{medicineId} AND state='已发货'
	
	</update>
 
 	<select id="allIndents" parameterType="java.lang.Integer" resultMap="indentQuery">
 		SELECT 
			indent.medicineid as medicineId,
			packagecode,
			name,
			indent.count as count,
			company,
			state
		FROM 
			indent LEFT JOIN delivery ON delivery.id=indent.companyid,medicine
		WHERE 
			indent.medicineid=medicine.id AND indent.customerid=#{customerId}
 	</select>
 
 </mapper>